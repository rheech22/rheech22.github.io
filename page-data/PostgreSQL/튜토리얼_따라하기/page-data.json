{"componentChunkName":"component---src-templates-wiki-template-tsx","path":"/PostgreSQL/튜토리얼_따라하기/","result":{"data":{"markdownRemark":{"html":"<h1 id=\"데이터베이스-만들고-psql-사용해보기\" style=\"position:relative;\">데이터베이스 만들고 psql 사용해보기<a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EB%A7%8C%EB%93%A4%EA%B3%A0-psql-%EC%82%AC%EC%9A%A9%ED%95%B4%EB%B3%B4%EA%B8%B0\" aria-label=\"데이터베이스 만들고 psql 사용해보기 permalink\" class=\"header-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p><code>mydb</code>라는 이름의 데이터베이스를 만들어 본다.</p>\n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">createdb mydb</code>\n        </deckgo-highlight-code>\n<p>DB 접속</p>\n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">psql mydb</code>\n        </deckgo-highlight-code>\n<p>다음과 같이 나오면 성공</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">psql (16.1 (Homebrew))\n도움말을 보려면 &quot;help&quot;를 입력하십시오.\n\nmydb=#</code>\n        </deckgo-highlight-code>\n<p>마지막 줄에 <code>#</code> 기호가 있다면 superuser라는 의미다. 아닌 경우에는 <code>#</code> 대신 <code>></code> 기호를 출력한다.</p>\n<p>튜토리얼을 따라 아래 명령어를 입력했다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# SELECT version();\n                                                           version\n------------------------------------------------------------------------------------------------------------------------------\n PostgreSQL 16.1 (Homebrew) on x86_64-apple-darwin22.6.0, compiled by Apple clang version 15.0.0 (clang-1500.1.0.2.5), 64-bit\n(1개 행)\n\nmydb=# SELECT current_date;\n current_date\n--------------\n 2024-01-13\n(1개 행)\n\nmydb=# SELECT 1 + 4;\n ?column?\n----------\n        5\n(1개 행)</code>\n        </deckgo-highlight-code>\n<p>psql에는 SQL이 아닌 <code>\\</code>으로 시작하는 여러 명령어가 있다. <code>\\h</code>를 입력하면 사용 가능한 도움말 목록을 출력한다. 그 중에서 <code>CREATE TABLE</code>을 확인하면 이런 내용이 나온다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">명령: CREATE TABLE\n설명: 새 테이블 만들기\n문법:\nCREATE [ [ GLOBAL | LOCAL ] { TEMPORARY | TEMP } | UNLOGGED ] TABLE [ IF NOT EXISTS ] 테이블_이름 ( [\n  { 칼럼이름 자료형 [ STORAGE { PLAIN | EXTERNAL | EXTENDED | MAIN | DEFAULT } ] [ COMPRESSION 압축_방법 ] [ COLLATE collation ] [ 칼럼_제약조건 [ ... ] ]\n    | 테이블_제약조건\n    | LIKE 원본테이블 [ LIKE구문옵션 ... ] }\n    [, ... ]\n] )\n[ INHERITS ( 상위_테이블 [, ... ] ) ]\n[ PARTITION BY { RANGE | LIST | HASH } ( { 칼럼이름 | ( 표현식 ) } [ COLLATE collation ] [ 연산자클래스 ] [, ... ] ) ]</code>\n        </deckgo-highlight-code>\n<p>psql에서 나오고 싶다면 <code>\\q</code>을 입력하자. <code>\\?</code>를 입력하면 여러 명령어를 확인할 수 있다.</p>\n<h1 id=\"테이블-생성\" style=\"position:relative;\">테이블 생성<a href=\"#%ED%85%8C%EC%9D%B4%EB%B8%94-%EC%83%9D%EC%84%B1\" aria-label=\"테이블 생성 permalink\" class=\"header-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>아래처럼 weather 테이블을 생성한다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# CREATE TABLE weather (\n    city            varchar(80),\n    temp_lo         int,           -- low temperature\n    temp_hi         int,           -- high temperature\n    prcp            real,          -- precipitation\n    date            date\n);\nCREATE TABLE</code>\n        </deckgo-highlight-code>\n<p>psql에서 공백, 탭, 줄바꿈은 자유롭게 사용할 수 있다. 세미콜론(;)이 오기 전까지 명령은 종료되지 않는 것으로 인식한다. 마치 lua처럼 <code>--</code>기호는 주석을 표현할 때 사용한다. 또한 쌍따옴표로 묶인 경우를 제외하고는 SQL 구문에서 대소문자를 구분하지 않는다.</p>\n<p>varchar(80)은 최대 80자 길이의 문자열을 저장할 수 있는 데이터 타입을 의미한다. int는 일반적인 정수, real은 4바이트 부동 소수점 타입이다. date는 단어 그대로 날짜 타입이다.</p>\n<p>cites라는 테이블을 하나 더 만들었다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# CREATE TABLE cities (\n    name            varchar(80),\n    location        point\n);\nCREATE TABLE</code>\n        </deckgo-highlight-code>\n<p>point는 지리적 위치를 표현하는 데이터 타입으로 PostgreSQL에서 제공하는 특별한 타입 중 하나이다.</p>\n<p><code>box</code>, <code>line</code>, <code>point</code>, <code>lseg</code>, <code>polygon</code>, <code>inet</code>, <code>macaddr</code></p>\n<h1 id=\"테이블-채우기\" style=\"position:relative;\">테이블 채우기<a href=\"#%ED%85%8C%EC%9D%B4%EB%B8%94-%EC%B1%84%EC%9A%B0%EA%B8%B0\" aria-label=\"테이블 채우기 permalink\" class=\"header-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>INSERT 문으로 테이블에 데이터를 채워보자. 튜토리얼을 보고 아래와 같은 순서로 데이터를 삽입했다.</p>\n<p>인풋은 <code>,</code>로 구분하고 타입에 맞는 데이터로 넣어줘야 한다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# INSERT INTO weather VALUES (&#39;San Francisco&#39;, 46, 50, 0.25, &#39;1994-11-27&#39;);\nINSERT 0 1</code>\n        </deckgo-highlight-code>\n<p>point 타입은 아래와 같이 형태를 요구한다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">INSERT INTO cities VALUES (&#39;San Francisco&#39;, &#39;(-194.0, 53.0)&#39;);\nINSERT 0 1</code>\n        </deckgo-highlight-code>\n<p>좀 더 명시적으로 작성하는 방법도 있다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">INSERT INTO weather (city, temp_lo, temp_hi, prcp, date)\n    VALUES (&#39;San Francisco&#39;, 43, 57, 0.0, &#39;1994-11-29&#39;);\nINSERT 01</code>\n        </deckgo-highlight-code>\n<p>모든 컬럼을 채워야 하는 것도 아니고 순서도 바꿀 수 있다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">INSERT INTO weather (date, city, temp_hi, temp_lo)\n    VALUES (&#39;1994-11-29&#39;, &#39;Hayward&#39;, 54, 37);</code>\n        </deckgo-highlight-code>\n<p>COPY 명령을 통해 파일로부터 로드하는 방법도 있다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">COPY weather FROM &#39;/home/user/weather.txt&#39;;</code>\n        </deckgo-highlight-code>\n<h1 id=\"테이블-쿼리하기\" style=\"position:relative;\">테이블 쿼리하기<a href=\"#%ED%85%8C%EC%9D%B4%EB%B8%94-%EC%BF%BC%EB%A6%AC%ED%95%98%EA%B8%B0\" aria-label=\"테이블 쿼리하기 permalink\" class=\"header-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>SELECT 문으로 테이블에서 데이터를 쿼리할 수 있다. SELECT 문은 테이블에서 가져올 컬럼을 명시하는 부분, 가져올 테이블을 명시하는 부분, 그리고 가져올 데이터를 한정하는 부분(옵셔널)으로 구분하여 사용한다. 이전 챕터에서 weather 테이블에 데이터를 채워놨으니 모두 조회해보자.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# SELECT * FROM weather;\n     city      | temp_lo | temp_hi | prcp |    date\n---------------+---------+---------+------+------------\n San Francisco |      46 |      50 | 0.25 | 1994-11-27\n San Francisco |      43 |      57 |    0 | 1994-11-29\n Hayward       |      37 |      54 |      | 1994-11-29\n(3개 행)</code>\n        </deckgo-highlight-code>\n<p><code>*</code>은 모든 컬럼을 의미하므로 아래와 같다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">SELECT city, temp_lo, temp_hi, prcp, date FROM weather;\n</code>\n        </deckgo-highlight-code>\n<p>표현식을 사용하여 결과를 바꿀 수도 있다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# SELECT city, (temp_hi+temp_lo)/2 AS temp_avg, date FROM weather;\n     city      | temp_avg |    date\n---------------+----------+------------\n San Francisco |       48 | 1994-11-27\n San Francisco |       50 | 1994-11-29\n Hayward       |       45 | 1994-11-29\n(3개 행)</code>\n        </deckgo-highlight-code>\n<p><code>AS</code>절은 출력되는 컬럼의 이름을 재정의한다.</p>\n<p>한편, <code>WHERE</code>절로 원하는 데이터만 출력할 수 있다. <code>WHERE</code>절은 boolean 표현식을 포함하는데 표현식을 통해 참으로 평가되는 행만 반환시킨다. <code>AND</code>, <code>OR</code>, <code>NOT</code>과 같은 boolean 연산자도 함께 사용할 수 있다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# SELECT * FROM weather\n    WHERE city = &#39;San Francisco&#39; AND prcp &gt; 0.0;\n     city      | temp_lo | temp_hi | prcp |    date\n---------------+---------+---------+------+------------\n San Francisco |      46 |      50 | 0.25 | 1994-11-27\n(1개 행)</code>\n        </deckgo-highlight-code>\n<p><code>ORDER BY</code>로 정렬이 가능하다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# SELECT * FROM weather\n    ORDER BY city;\n     city      | temp_lo | temp_hi | prcp |    date\n---------------+---------+---------+------+------------\n Hayward       |      37 |      54 |      | 1994-11-29\n San Francisco |      46 |      50 | 0.25 | 1994-11-27\n San Francisco |      43 |      57 |    0 | 1994-11-29\n(3개 행)</code>\n        </deckgo-highlight-code>\n<p>San Francisco도 완전히 정렬시키고 싶다면,</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# SELECT * FROM weather\n    ORDER BY city, temp_lo;\n     city      | temp_lo | temp_hi | prcp |    date\n---------------+---------+---------+------+------------\n Hayward       |      37 |      54 |      | 1994-11-29\n San Francisco |      43 |      57 |    0 | 1994-11-29\n San Francisco |      46 |      50 | 0.25 | 1994-11-27\n(3개 행)</code>\n        </deckgo-highlight-code>\n<p><code>DISTINCT</code>로 중복되는 행을 제거할 수 있다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# SELECT DISTINCT city FROM weather;\n     city\n---------------\n Hayward\n San Francisco\n(2개 행)</code>\n        </deckgo-highlight-code>\n<h1 id=\"테이블-조인하기\" style=\"position:relative;\">테이블 조인하기<a href=\"#%ED%85%8C%EC%9D%B4%EB%B8%94-%EC%A1%B0%EC%9D%B8%ED%95%98%EA%B8%B0\" aria-label=\"테이블 조인하기 permalink\" class=\"header-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p><code>JOIN</code>을 사용하면 한 번에 여러 테이블에 접근할 수 있다. 만약 날씨 기록을 관련된 도시와 함께 요청하고 싶다면</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# SELECT * FROM weather JOIN cities ON city = name;\n     city      | temp_lo | temp_hi | prcp |    date    |     name      | location\n---------------+---------+---------+------+------------+---------------+-----------\n San Francisco |      46 |      50 | 0.25 | 1994-11-27 | San Francisco | (-194,53)\n San Francisco |      43 |      57 |    0 | 1994-11-29 | San Francisco | (-194,53)\n(2개 행)</code>\n        </deckgo-highlight-code>\n<p>여기서는 <code>*</code>을 사용하여 모든 컬럼을 가져오도록 했지만, 실제 프로덕션 레벨에서는 항상 명시적으로 컬럼을 작성하는 것이 좋다. 만약 테이블에 컬럼이 추가되면 결과도 달라질 것이기 때문이다.</p>\n<p>현재 weather의 컬럼과 cities의 컬럼의 이름이 겹치는 경우는 없지만, 만약에 그런 경우가 있다면 아래와 같이 작성해야 한다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# SELECT weather.city, weather.temp_lo, weather.temp_hi,\n       weather.prcp, weather.date, cities.location\n    FROM weather JOIN cities ON weather.city = cities.name;</code>\n        </deckgo-highlight-code>\n<p><code>JOIN/ON</code> 구문을 사용하지 않는 아래와 같은 방식도 있다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# SELECT *\n    FROM weather, cities\n    WHERE city = name;\n     city      | temp_lo | temp_hi | prcp |    date    |     name      | location\n---------------+---------+---------+------+------------+---------------+-----------\n San Francisco |      46 |      50 | 0.25 | 1994-11-27 | San Francisco | (-194,53)\n San Francisco |      43 |      57 |    0 | 1994-11-29 | San Francisco | (-194,53)\n(2개 행)</code>\n        </deckgo-highlight-code>\n<p>이 방법은 <code>JOIN/ON</code> 구문보다 앞선 방식으로 좀 더 단순해 보이지만, 쿼리를 읽는 사람 입장에서는 <code>JOIN/ON</code> 구문을 사용하는 것이 더 쉽게 이해하기 좋다. <code>JOIN</code>을 위한 조건이 <code>WHERE</code> 절에 섞여있지 않아도 된다.</p>\n<p>앞선 예제에서는 Hayward가 결과에서 제외됐다. <code>ON</code>에 작성된 조건을 만족하지 못했기 때문인데 만약 조건에 만족하지 못한 경우에도 결과에 포함시키고 싶다면 어떻게 해야할까? 이런 경우 <code>OUTER JOIN</code>을 사용할 수 있다. (지금까지 했던 것은 사실 <code>INNER JOIN</code>이다.)</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">SELECT *\n    FROM weather LEFT OUTER JOIN cities ON weather.city = cities.name;\n     city      | temp_lo | temp_hi | prcp |    date    |     name      | location\n---------------+---------+---------+------+------------+---------------+-----------\n San Francisco |      46 |      50 | 0.25 | 1994-11-27 | San Francisco | (-194,53)\n San Francisco |      43 |      57 |    0 | 1994-11-29 | San Francisco | (-194,53)\n Hayward       |      37 |      54 |      | 1994-11-29 |</code>\n        </deckgo-highlight-code>\n<p>위 예제에서 오른쪽 테이블(cities)의 내용은 왼쪽 테이블(weather)와 일치하는 경우에만 포함되고, 왼쪽 테이블은 모두 포함된다. <code>LEFT OUTER JOIN</code>의 동작 방식이 이렇다. 반대 방향인 <code>RIGHT OUTER JOIN</code>과 양쪽 모두를 포함하는 <code>FULL OUTER JOIN</code>도 있다.</p>\n<p><code>SELF JOIN</code>은 테이블 자체적으로 조인을 수행한다. 만약 다른 모든 행과 데이터를 비교하여 원하는 결과를 출력해야 한다면 사용해볼 수 있다. 예시는 아래와 같다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">SELECT w1.city, w1.temp_lo AS low, w1.temp_hi AS high,\n       w2.city, w2.temp_lo AS low, w2.temp_hi AS high\n    FROM weather w1 JOIN weather w2\n        ON w1.temp_lo &lt; w2.temp_lo AND w1.temp_hi &gt; w2.temp_hi;\n     city      | low | high |     city      | low | high\n---------------+-----+------+---------------+-----+------\n San Francisco |  43 |   57 | San Francisco |  46 |   50\n Hayward       |  37 |   54 | San Francisco |  46 |   50\n(2개 행)</code>\n        </deckgo-highlight-code>\n<p>테이블을 각각 <code>w1</code>, <code>w2</code>로 별칭한 것처럼 라벨을 통해 타이핑을 줄일 수 있다.</p>\n<h1 id=\"aggregate-function\" style=\"position:relative;\">Aggregate Function<a href=\"#aggregate-function\" aria-label=\"aggregate function permalink\" class=\"header-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>Aggregate Function은 여러 행에 대한 단일 결과를 계산한다. 예를 들어, 행 집합에 대한 <code>count</code>, <code>sum</code>, <code>avg</code>, <code>max</code>, <code>min</code>을 계산할 수 있다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# SELECT max(temp_lo) FROM weather;\n max\n-----\n  46\n(1개 행)</code>\n        </deckgo-highlight-code>\n<p>단, <code>WHERE</code> 절에서는 사용할 수 없다. <code>WHERE</code>를 통해 어떤 행을 대상으로 집계를 해야할지 결정하기 때문에 <code>WHERE</code> 절의 표현식은 집계 함수가 실행되기 전에 평가되어야 하기 때문이다. 이럴 땐 서브 쿼리를 사용할 수 있다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# SELECT city FROM weather\n    WHERE temp_lo = (SELECT max(temp_lo) FROM weather);\n     city\n---------------\n San Francisco\n(1개 행)</code>\n        </deckgo-highlight-code>\n<p>Aggregate Function을 <code>GROUP BY</code>와 함께 효과적으로 사용할 수 있다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# SELECT city, count(*), max(temp_lo)\n    FROM weather\n    GROUP BY city;\n     city      | count | max\n---------------+-------+-----\n Hayward       |     1 |  37\n San Francisco |     2 |  46\n(2개 행)</code>\n        </deckgo-highlight-code>\n<p>또한 그룹으로 묶인 행들을 <code>HAVING</code>을 사용하여 걸러낼 수도 있다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# SELECT city, count(*), max(temp_lo)\n    FROM weather\n    GROUP BY city\n    HAVING max(temp_lo) &lt; 40;\n  city   | count | max\n---------+-------+-----\n Hayward |     1 |  37\n(1개 행)</code>\n        </deckgo-highlight-code>\n<p><code>LIKE</code> 연산자를 사용한 예시도 있다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">SELECT city, count(*), max(temp_lo)\n    FROM weather\n    WHERE city LIKE &#39;S%&#39;\n    GROUP BY city;</code>\n        </deckgo-highlight-code>\n<p><code>HAVING</code>과 <code>WHERE</code>의 차이는 순서에 있다. <code>WHERE</code>는 <code>GROUP</code> 및 Aggregate Function이 수행되기 전에 행을 선택하는 반면, <code>HAVING</code>은 <code>GROUP</code> 및 Aggregate Function이 수행된 후에 행을 선택한다. 따라서 <code>HAVING</code>에는 항상 Aggregate Function이 포함된다. 사실 <code>HAVING</code>에서 집계 함수를 사용하지 않을 수도 있지만 그런 경우에는 <code>WHERE</code> 단계에 해당 조건을 적용하는 것이 더 효율적이다.</p>\n<p>한편 각 Aggregate Function에 사용할 수 있는 옵션인 <code>FILTER</code>도 있다. 각 함수의 인풋만을 한정한다는 점을 제외하고 <code>WHERE</code>와 유사하다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">SELECT city, count(*) FILTER (WHERE temp_lo &lt; 45), max(temp_lo)\n    FROM weather\n    GROUP BY city;\n     city      | count | max\n---------------+-------+-----\n Hayward       |     1 |  37\n San Francisco |     1 |  46\n(2개 행)</code>\n        </deckgo-highlight-code>\n<h1 id=\"updates\" style=\"position:relative;\">Updates<a href=\"#updates\" aria-label=\"updates permalink\" class=\"header-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p><code>UPDATE</code>를 사용하여 데이터를 수정할 수 있다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# UPDATE weather\n    SET temp_hi = temp_hi - 2,  temp_lo = temp_lo - 2\n    WHERE date &gt; &#39;1994-11-28&#39;;\nUPDATE 2\n\nmydb=# SELECT * FROM weather;\n\n     city      | temp_lo | temp_hi | prcp |    date\n---------------+---------+---------+------+------------\n San Francisco |      46 |      50 | 0.25 | 1994-11-27\n San Francisco |      41 |      55 |    0 | 1994-11-29\n Hayward       |      35 |      52 |      | 1994-11-29\n(3 rows)</code>\n        </deckgo-highlight-code>\n<h1 id=\"deletions\" style=\"position:relative;\">Deletions<a href=\"#deletions\" aria-label=\"deletions permalink\" class=\"header-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>삭제는 다음과 같다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# DELETE FROM weather WHERE city = &#39;Hayward&#39;;\nDELETE 1\nmydb=# SELECT * FROM weather;\n     city      | temp_lo | temp_hi | prcp |    date\n---------------+---------+---------+------+------------\n San Francisco |      46 |      50 | 0.25 | 1994-11-27\n San Francisco |      41 |      55 |    0 | 1994-11-29\n(2개 행)</code>\n        </deckgo-highlight-code>\n<p>아래와 같이 사용하면 모든 행을 삭제하기 때문에 주의하자.</p>\n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">DELETE FROM tablename;</code>\n        </deckgo-highlight-code>\n<h1 id=\"views\" style=\"position:relative;\">Views<a href=\"#views\" aria-label=\"views permalink\" class=\"header-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p><code>VIEW</code>를 사용하면 매번 필요할 때마다 같은 쿼리를 입력하지 않아도 된다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# CREATE VIEW myview AS\n    SELECT name, temp_lo, temp_hi, prcp, date, location\n        FROM weather, cities\n        WHERE city = name;\nCREATE VIEW\nmydb=# SELECT * FROM myview;\n     name      | temp_lo | temp_hi | prcp |    date    | location\n---------------+---------+---------+------+------------+-----------\n San Francisco |      46 |      50 | 0.25 | 1994-11-27 | (-194,53)\n San Francisco |      41 |      55 |    0 | 1994-11-29 | (-194,53)\n(2개 행)</code>\n        </deckgo-highlight-code>\n<h1 id=\"foreign-keys\" style=\"position:relative;\">Foreign Keys<a href=\"#foreign-keys\" aria-label=\"foreign keys permalink\" class=\"header-anchor after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>앞서 활용한 테이블 weather와 cities에서 cities에 포함된 도시만 weather에 넣을 수 있도록 해야 한다고 가정해보자. 이런 경우 먼저 cities를 살펴 일치하는 기록이 있는지 확인한 후 새로운 날씨 데이터를 weather에 넣을 수 있도록 하거나 혹은 넣지 못하도록 해야할 것이다. 이처럼 테이블간의 관계를 일관되게 유지시킴으로써 데이터베이스의 신뢰도를 높이는 것을 데이터의 참조 무결성(referential integrity)라 한다. 다만 위와 같은 과정을 매번 거쳐야 하는 것은 매우 귀찮은 일이기 때문에 primary key와 foreign key를 사용하여 테이블의 관계를 선언할 수 있다. 우선 테이블을 다시 생성하기 전에 삭제부터 한다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# DROP VIEW myview;\nDROP VIEW\nmydb=# DROP TABLE cities;\nDROP TABLE\nmydb=# DROP TABLE weather;\nDROP TABLE</code>\n        </deckgo-highlight-code>\n<p>테이블을 다시 만들자.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">CREATE TABLE cities (\n        name     varchar(80) primary key,\n        location point\n);\n\nCREATE TABLE weather (\n        city      varchar(80) references cities(name),\n        temp_lo   int,\n        temp_hi   int,\n        prcp      real,\n        date      date\n);</code>\n        </deckgo-highlight-code>\n<p>weather에 <code>INSERT</code>를 시도하면 cities에 없는 도시를 저장하려 했기에 실패한다.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# INSERT INTO weather VALUES (&#39;Berkeley&#39;, 45, 53, 0.0, &#39;1994-11-28&#39;);\nERROR:  insert or update on table &quot;weather&quot; violates foreign key constraint &quot;weather_city_fkey&quot;\n상세정보:  Key (city)=(Berkeley) is not present in table &quot;cities&quot;.</code>\n        </deckgo-highlight-code>\n<p>먼저 도시를 cities에 저장하고 다시 시도하면 <code>INSERT</code> 성공</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"one-dark\"  >\n          <code slot=\"code\">mydb=# INSERT INTO cities VALUES (&#39;Berkeley&#39;, &#39;(-194.0, 53.0)&#39;);\nINSERT 0 1\nmydb=# INSERT INTO weather VALUES (&#39;Berkeley&#39;, 45, 53, 0.0, &#39;1994-11-28&#39;);\nINSERT 0 1\nmydb=# SELECT * FROM weather;\n   city   | temp_lo | temp_hi | prcp |    date\n----------+---------+---------+------+------------\n Berkeley |      45 |      53 |    0 | 1994-11-28\n(1개 행)</code>\n        </deckgo-highlight-code>","excerpt":"데이터베이스 만들고 psql 사용해보기 mydb라는 이름의 데이터베이스를 만들어 본다. DB 접속 다음과 같이 나오면 성공 마지막 줄에 # 기호가 있다면 superuser라는 의미다. 아닌 경우에는 # 대신 > 기호를 출력한다. 튜토리얼을 따라 아래…","timeToRead":7,"headings":[{"id":"데이터베이스-만들고-psql-사용해보기","value":"데이터베이스 만들고 psql 사용해보기","depth":1},{"id":"테이블-생성","value":"테이블 생성","depth":1},{"id":"테이블-채우기","value":"테이블 채우기","depth":1},{"id":"테이블-쿼리하기","value":"테이블 쿼리하기","depth":1},{"id":"테이블-조인하기","value":"테이블 조인하기","depth":1},{"id":"aggregate-function","value":"Aggregate Function","depth":1},{"id":"updates","value":"Updates","depth":1},{"id":"deletions","value":"Deletions","depth":1},{"id":"views","value":"Views","depth":1},{"id":"foreign-keys","value":"Foreign Keys","depth":1}],"frontmatter":{"created":"2024-01-13 17:29:25 +0900","updated":"2024-01-14 04:28:05 +0900"},"fields":{"slug":"/PostgreSQL/튜토리얼_따라하기","title":"튜토리얼 따라하기"}}},"pageContext":{"slug":"/PostgreSQL/튜토리얼_따라하기","title":"튜토리얼 따라하기"}},"staticQueryHashes":["2328167765","3156452557"],"slicesMap":{}}